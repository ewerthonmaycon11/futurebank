{% extends "base.html" %}
{% block conteudo %}

<style>
/* CSS B√ÅSICO PARA O CARD DE TRANSFER√äNCIA (Ajuste para o seu estilo futurista) */
.transfer-card {
    max-width: 500px;
    margin: 40px auto;
    padding: 30px;
    border-radius: 15px;
    background: #1e212b; /* Cor escura */
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    color: #e0e0e0;
}
.result-box {
    margin-top: 15px;
    padding: 10px;
    border-radius: 8px;
    background-color: rgba(0, 180, 216, 0.1);
    border: 1px solid #00b4d8;
}
.result-box strong {
    color: #00b4d8;
}

/* Garante que o CSS do dashboard seja importado ou ajustado para os inputs */
.form-control, .form-select, .btn-modern {
    /* use aqui as classes que voc√™ definiu no dashboard.html */
    border-radius: 10px;
    padding: 10px;
    width: 100%;
    margin-bottom: 10px;
}
.input-group {
    display: flex;
}
.input-group .form-select {
    flex: 0 0 40%;
}
.input-group .form-control {
    flex-grow: 1;
    margin-left: 5px;
}
</style>

<div class="container">
    <div class="transfer-card">
        <h2>üí∞ Nova Transfer√™ncia</h2>
        <p class="text-muted">Converta e envie fundos para outros usu√°rios do FutureBank.</p>

        <form method="POST" action="{{ url_for('transfer') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

            <label class="form-label mt-3">Usu√°rio Destino (Username)</label>
            <input type="text" name="para" class="form-control" placeholder="Ex: usuario_destino" required>

            <label class="form-label mt-3">Valor e Moeda de Origem</label>
            <div class="input-group">
                <select name="moeda_origem" id="moeda_origem" class="form-select" required>
                    {% for moeda, valor_real in moedas_disponiveis.items() %}
                        <option value="{{ moeda }}" data-rate="{{ valor_real }}">{{ moeda | upper }} (1 = R$ {{ "%.2f"|format(valor_real) }})</option>
                    {% endfor %}
                </select>
                <input type="number" step="0.01" name="valor" id="valor_origem" class="form-control" placeholder="0.00" required min="0.01">
            </div>
            
            <div class="result-box">
                <span class="text-muted">Valor a ser debitado (em R$):</span>
                <div id="valor_convertido">R$ 0.00</div>
            </div>

            <button type="submit" class="btn-modern btn-transfer mt-4">üí∏ Confirmar Transfer√™ncia</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const inputValor = document.getElementById('valor_origem');
        const selectMoeda = document.getElementById('moeda_origem');
        const resultadoDiv = document.getElementById('valor_convertido');

        function converterEmTempoReal() {
            const valor = parseFloat(inputValor.value) || 0;
            
            // Pega a taxa de c√¢mbio do atributo data-rate da op√ß√£o selecionada
            const taxa = parseFloat(selectMoeda.options[selectMoeda.selectedIndex].getAttribute('data-rate'));
            
            if (valor <= 0 || isNaN(taxa)) {
                resultadoDiv.innerHTML = 'R$ 0.00';
                return;
            }

            const valorEmReal = (valor * taxa).toFixed(2);
            resultadoDiv.innerHTML = `<strong>R$ ${valorEmReal}</strong>`;
        }

        // Adiciona listeners para mudan√ßa e input
        inputValor.addEventListener('input', converterEmTempoReal);
        selectMoeda.addEventListener('change', converterEmTempoReal);

        // Executa na carga para inicializar o valor
        converterEmTempoReal();
    });
</script>

{% endblock %}